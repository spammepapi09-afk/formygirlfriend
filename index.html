<!DOCTYPE html>
<html>
<head>
  <title>For my girlfriend Andrea Nieto</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body class="scissors">
  <div class="envelop">
    <div class="envelop__front-paper"></div>
    <div class="envelop__back-paper"></div>
    <div class="envelop__up-paper js-up-paper"></div>
    <div class="envelop__sticker js-sticker"></div>
    <div class="envelop__false-sticker"></div>
    <div class="envelop__content js-envelop-content">
      <div class="love-notes">
        <!-- NOTE 1 -->
        <div class="note js-note">
          <div class="note__text">
            <p>Hi Birthday Girl, I just wanted to let you know i love you very much ...</p>
          </div>
        </div>
        <!-- NOTE 2 -->
        <div class="note js-note">
          <div class="note__text">
            <p>Hi Andrea, im loving the time im spending with you every day ...</p>
          </div>
        </div>
        <!-- NOTE 3 -->
        <div class="note js-note">
          <div class="note__text">
            <p>Meow, Hi pretty girl originally this was for some more love stuff ...</p>
            <p>Iloveyoumommy;.</p>
          </div>
        </div>
        <!-- NOTE 4 -->
        <div class="note js-note">
          <div class="note__text">
            <p>Hi baby, I wanted to list some stuff i love abt you even tho ...</p>
          </div>
        </div>
        <!-- NOTE 5 -->
        <div class="note js-note">
          <div class="note__text">
            <p>Hiiii marmalade, do you remember this song? ive listened to it 12 times ...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="wrapper"></div>

  <script>
    const notes = document.querySelectorAll(".js-note");
    let currentAudio = null;

    function recize_notes() {
      notes.forEach(n => { 
        n.classList.remove("active"); 
        gsap.set(n, {height:"30%", clearProps:"all"}); 
      });
    }

    function notes_ready() {
      gsap.to(".js-envelop-content", {height:"110%", duration:0.5});

      notes.forEach((note, i) => {
        note.addEventListener("click", () => {
          const files = [
            "audio/1.mp3",
            "audio/2.mp3",
            "audio/3.mp3",
            "audio/4.mp3",
            "audio/5.mp3"
          ];
          const file = files[i];
          if(file){
            if(!currentAudio || !currentAudio.src.includes(file)){
              if(currentAudio) currentAudio.pause();
              currentAudio = new Audio(file);
              currentAudio.play();
            }
          }

          if(note.classList.contains("active")){
            note.classList.remove("active");
            gsap.set(note, {height:"30%", clearProps:"all"});
          } else {
            notes.forEach(n => {n.classList.remove("active"); gsap.set(n, {height:"30%", clearProps:"all"});});
            note.classList.add("active");
            gsap.set(note, {height:70 + 20*i + "%"});
          }
        });

        // --- MOBILE + DESKTOP DRAG FIX ---
        let startY, startBottom;

        function dragStart(e) {
          e.preventDefault();
          startY = e.touches ? e.touches[0].clientY : e.clientY;
          startBottom = parseFloat(getComputedStyle(note).bottom);
          
          if(e.touches) {
            document.addEventListener("touchmove", dragMove, {passive: false});
            document.addEventListener("touchend", dragEnd);
          } else {
            document.addEventListener("mousemove", dragMove);
            document.addEventListener("mouseup", dragEnd);
          }
        }

        function dragMove(e) {
          if(e.touches) e.preventDefault();
          let cur = e.touches ? e.touches[0].clientY : e.clientY;
          let newB = startBottom + (startY - cur);
          if(newB < 0) newB = 0;
          note.style.bottom = newB + "px";
        }

        function dragEnd(e) {
          if(e.touches) {
            document.removeEventListener("touchmove", dragMove);
            document.removeEventListener("touchend", dragEnd);
          } else {
            document.removeEventListener("mousemove", dragMove);
            document.removeEventListener("mouseup", dragEnd);
          }
        }

        note.addEventListener("mousedown", dragStart);
        note.addEventListener("touchstart", dragStart, {passive: false});
      });
    }

    function set_up_paper() {
      gsap.set(".js-up-paper", {bottom:"0%", rotation:0, zIndex:200, clipPath:"polygon(0% 0%,100% 0%,50% 61%)", onComplete: notes_ready});
    }
    function envelop_transition() {
      gsap.to(".js-up-paper", {bottom:"50%", duration:0.5, onComplete: set_up_paper});
      const up = document.querySelector(".js-up-paper");
      up.removeEventListener("click", envelop_transition);
      up.classList.remove("cursor");
    }

    function sticker() {
      gsap.set(".js-sticker", {width:"20%", left:"-80%"});
      document.body.classList.remove("scissors");
      document.querySelector(".js-sticker").removeEventListener("click", sticker);
      const up = document.querySelector(".js-up-paper");
      up.addEventListener("click", envelop_transition);
      up.classList.add("cursor");
    }
    document.querySelector(".js-sticker").addEventListener("click", sticker);

    window.onresize = recize_notes;

    // --- HEART SPAWN ---
    const heartWrapper = document.createElement("div");
    heartWrapper.classList.add("wrapper");
    document.body.appendChild(heartWrapper);

    function spawnHeart() {
      const heart = document.createElement("div");
      heart.classList.add("heart");
      const xOffset = Math.random() * window.innerWidth;
      heart.style.left = xOffset + "px";
      heart.style.bottom = "10px";
      heart.style.animation = `floatUp ${4 + Math.random()*3}s ease-in forwards`;
      heartWrapper.appendChild(heart);
      setTimeout(() => heart.remove(), 7000);
    }

    setInterval(spawnHeart, 500);
  </script>

  <style>
    * { padding: 0; margin: 0; box-sizing: border-box; }
    html, body { height: 100%; }
    body { width: 100%; overflow: hidden; position: relative; background: -webkit-radial-gradient(center, rgba(0,0,70,1) 0%, #000 60%); }

    .envelop { width: 15rem; height: 10rem; position: absolute; left:0; right:0; margin:auto; }
    @media (min-width: 400px) and (max-width: 600px) { .envelop { width: 20rem; height: 15rem; } }
    @media (min-width: 600px) { .envelop { width: 25rem; height: 20rem; } }
    @media (min-width: 600px) and (min-height: 600px) { .envelop { bottom: 20%; } }

    .envelop__front-paper { position:absolute; width:100%; height:100%; bottom:0; left:0; border-radius:.7rem; border:.35rem solid #005A8C; background-color:#0077B2; clip-path: polygon(100% 0%, 50% 70%, 0% 0%, 0% 100%, 100% 100%); z-index:300; }
    .envelop__back-paper { position:absolute; width:100%; height:100%; bottom:0; left:0; border-radius:.7rem; background-color:#005A8C; clip-path: polygon(0% 0%,100% 0%,90% 100%,0% 90%); z-index:100; }
    .envelop__up-paper { position:relative; width:100%; height:100%; bottom:0; left:0; border-radius:.7rem; background-color:#005A8C; z-index:400; clip-path: polygon(0% 0%,100% 0%,50% 81%); }
    .envelop__sticker { width:100%; height:20%; position:absolute; margin:auto; top:30%; left:0; bottom:0; right:0; z-index:400; background-image:url("https://www.freepnglogos.com/uploads/heart-png/emoji-heart-33.png"); background-color:#E6F2FA; border:.3rem solid #CCE0F0; background-size:2rem; background-position:center; }
    .envelop__false-sticker { width:20%; height:20%; position:absolute; margin:auto; top:30%; left:80%; bottom:0; right:0; z-index:300; background-image:url("https://www.freepnglogos.com/uploads/heart-png/emoji-heart-33.png"); background-color:#E6F2FA; border:.3rem solid #CCE0F0; background-size:2rem; background-position:center; }
    .envelop__content { position:absolute; width:100%; height:100%; bottom:0; left:0; z-index:200; }

    .love-notes { width:100%; height:100%; display:flex; flex-direction:column; align-items:center; }
    .note { width:95%; height:30%; background-color:#FFC0CB; position:absolute; overflow:hidden; transition:height 0.5s, opacity 0.25s; box-shadow:0 0 5px rgba(0,0,0,0.75); }
    .note:nth-child(1) { bottom:80%; }
    .note:nth-child(2) { bottom:60%; }
    .note:nth-child(3) { bottom:40%; }
    .note:nth-child(4) { bottom:20%; }
    .note:nth-child(5) { bottom:0%; }
    .note:hover { cursor:pointer; height:45%; }
    .note__text { font-family:"Sofia"; padding:1rem; }
    .note__text p { font-size:.9rem; margin-bottom:1rem; text-align:center; }

    .wrapper { position:fixed; bottom:0; left:0; width:100%; height:100%; pointer-events:none; overflow:visible; z-index:1000; }
    .heart { position:absolute; width:25px; height:25px; background-color:#7ec8ff; transform:rotate(-45deg); }
    .heart:before, .heart:after { content:""; position:absolute; width:25px; height:25px; background-color:#7ec8ff; border-radius:50%; }
    .heart:before { top:-12.5px; left:0; }
    .heart:after { left:12.5px; top:0; }
    @keyframes floatUp { 0% { transform: rotate(-45deg) translate(0,0); opacity:1; } 100% { transform: rotate(-45deg) translate(var(--x,0px), -600px); opacity:0; } }
  </style>
</body>
</html>
